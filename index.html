<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
			<title>D3 Page Template</title>
			<script type="text/javascript" src="d3.js"></script>
			<!--<link rel="stylesheet" href="style.css">-->
			<style type="text/css">
				/*style of class axis*/	
				body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
				.axis path,
				.axis line {
					fill: none;
					stroke: violet;
					shape-rendering: crispEdges;
				}
				.axis text {
					font-family: sans-serif;
					font-size: 10px;
				}
			</style>
	</head>
	<body>
		<!--
			### CSV File ###
		-->
		<fieldset id="load">
			<form>
				<label for="csvFileInput"> <strong>CSV File:</strong>
				</label>
				<button type="button" onclick="test('https://raw.githubusercontent.com/shourikan/Viso/master/packed.tsv')">Load</button>
			</form>
			<br>
			<div id="output" style="max-height:50px;overflow-y:scroll;border:green solid 1px">
			</div>
		</fieldset>
		<!--
			### Chart div ###
		
		<div id="canvas" style="width: 800px; height:400px;"></div>-->
		<!--
			### CSV Script ###
		-->
		<script type="text/javascript" src="read-csv.js"></script>
		<!--
			### D3 Script ###
		-->
		<script type="text/javascript">

		function swapPhase(p){
			var d = document.getElementsByClassName("dot")[0];
			var s = document.getElementsByClassName("shape")[0];
			if(p==1){
				d.setAttribute("display", "");
				s.setAttribute("display", "none");
				phase = 1;
			} else if (p == 2){
				d.setAttribute("display", "none");
				s.setAttribute("display", "");
				phase = 2;
			}
		}

		function drawChart(data){

			//Turn off loading window
			document.getElementById("load").style.display = "none";

			//Width and height
			var w = 1440;
			var h = 960;
			var size = 1;
			var padding = 30;
			phase = 1;

			//Color palette
			var colors = ["white", "#F19CA2", "#EDF8B1", "#CC4C02", "#7FCDBB", "#C7E9B4", 
			"#FFFFD9", "#1D91C0", "#ED5276", "#00585E", "#253494", "#FBF484", "#FF5729", "#00BDAA", "white",
			"#081D58", "#993404", "#FEC44F", "white", "#F4CDA5", "#9C4368", "#A5D3E6", "#009494", "#F8D7D0", "#004E2A"];

			//Create SVG elements
			var svg = d3.select("body")
				.append("svg")
					.attr("width", "100%")
					.attr("height", "100%")
				.append("g")
					.call(d3.zoom().on("zoom", function () {
					container.attr("transform", d3.event.transform);
					var scale = container.attr("transform").match(/\((.*?)\)/g)[1];
					scale = scale.substring(1, scale.length-1);
					//console.log(scale);
					if (parseInt(scale) < 20 && phase == 2)
						swapPhase(1);
					else if (parseInt(scale) >= 20 && phase == 1)
						swapPhase(2);
				}));

			var rect = svg.append("rect")
				.attr("width", w)
				.attr("height", h)
				.style("fill", "none")
				.style("pointer-events", "all");

			var container = svg.append("g");

			if (data!=null){
				var dataset = data;
				
				//Solution to negative values could be global shift of values by min value

				var xScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[0]; }), d3.max(dataset, function(d) { return d[0]; })])
								.range([padding, w-padding*2]);
				var yScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[1]; }), d3.max(dataset, function(d) { return d[1]; })])
								.range([h-padding, padding]);
				/*var rScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[1]; }), d3.max(dataset, function(d) { return d[1]; })])
								.range([size, size]);*/														
				
								
				/*var xAxis = d3.axisBottom()
							.scale(xScale)
							.ticks(9);
							
				var yAxis = d3.axisLeft()
							.scale(yScale)
							.ticks(5);*/
						
				//Draw dots
				dot = container.append("g")
						.attr("class", "dot")
						.attr("display", "")
					.selectAll("circle")
						.data(dataset)
						.enter()
					.append("circle")
						.attr("cx",function(d) { return xScale(d[0]);})
						.attr("cy",function(d) { return yScale(d[1]);})
						.attr("r", 1)
						.attr("fill", function(d) { return colors[d[3]]; })
					.append("svg:title")
						.text(function(d) { return d[2]; });
						
				//Draw shapes
				shape = container.append("g")
						.attr("class", "shape")
						.attr("display", "none")
					.selectAll("circle")
						.data(dataset)
						.enter()
					.append("circle")
						.attr("cx",function(d) { return xScale(d[0]);})
						.attr("cy",function(d) { return yScale(d[1]);})
						.attr("r", 1)
						.attr("fill", "black");
						
					/* svg.selectAll("text")
					.data(dataset)
					.enter()
					.append("text")
					.text(function(d) {
							return d[0] + "," + d[1];
					})
					.attr("x",function(d) {
							return xScale(d[0]);
					})
					.attr("y",function(d) {
							return yScale(d[1]);
					})
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px")
					.attr("fill", "red"); */
					
									
					/*svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate("+ (-size) +"," + (h - padding +size) + ")")
						.call(xAxis);
					
					svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate("+ (padding-size) +","+ (size) +")")
						.call(yAxis);*/
			}
		}

		</script>
	</body>
</html>