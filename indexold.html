<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
			<title>D3 Page Template</title>
			<script type="text/javascript" src="d3.js"></script>
			<!--<link rel="stylesheet" href="style.css">-->
			<style type="text/css">
				/*style of class axis*/	
				body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
				.axis path,
				.axis line {
					fill: none;
					stroke: violet;
					shape-rendering: crispEdges;
				}
				.axis text {
					font-family: sans-serif;
					font-size: 10px;
				}
			</style>
	</head>
	<body>
		<!--
			### CSV File ###
		-->
		<fieldset id="load">
			<form>
				<label for="csvFileInput"> <strong>CSV File:</strong>
				</label>
				<input type="file" id="csvFileInput" onchange="handleFiles(this.files)"
				accept=".csv">
				<button type="button" onclick="drawChart(null)">Auto</button>
			</form>
			<br>
			<div id="output" style="max-height:50px;overflow-y:scroll;border:green solid 1px">
			</div>
		</fieldset>
		<!--
			### Chart div ###
		
		<div id="canvas" style="width: 800px; height:400px;"></div>-->
		<!--
			### CSV Script ###
		-->
		<script type="text/javascript" src="read-csv.js"></script>
		<!--
			### D3 Script ###
		-->
		<script type="text/javascript">

		function drawChart(data){

			//Turn off loading window
			document.getElementById("load").style.display = "none";

			//Width and height
			var w = 800;
			var h = 400;
			var size = 1;
			var padding = 30;

			//Create SVG elements
			var svg = d3.select("body")
				.append("svg")
					.attr("width", "100%")
					.attr("height", "100%")
				.append("g")
					.call(d3.zoom().on("zoom", function () {
					container.attr("transform", d3.event.transform)
				}));

			var rect = svg.append("rect")
				.attr("width", w)
				.attr("height", h)
				.style("fill", "none")
				.style("pointer-events", "all");

			var container = svg.append("g");

			if (data!=null){
				var dataset = data;
				
				//Solution to negative values could be global shift of values by min value

				var xScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[0]; }), d3.max(dataset, function(d) { return d[0]; })])
								.range([padding, w-padding*2]);
				var yScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[1]; }), d3.max(dataset, function(d) { return d[1]; })])
								.range([h-padding, padding]);
				var rScale = d3.scaleLinear()
								.domain([d3.min(dataset, function(d) { return d[1]; }), d3.max(dataset, function(d) { return d[1]; })])
								.range([size, size]);														
				
								
				/*var xAxis = d3.axisBottom()
							.scale(xScale)
							.ticks(9);
							
				var yAxis = d3.axisLeft()
							.scale(yScale)
							.ticks(5);*/
							
				dot = container.append("g")
						.attr("class", "dot")
					.selectAll("circle")
						.data(dataset)
						.enter()
					.append("circle")
						.attr("cx",function(d) { return xScale(d[0]);})
						.attr("cy",function(d) { return yScale(d[1]);})
						.attr("r", function(d) { return rScale(d[1]);});	
						
					/* svg.selectAll("text")
					.data(dataset)
					.enter()
					.append("text")
					.text(function(d) {
							return d[0] + "," + d[1];
					})
					.attr("x",function(d) {
							return xScale(d[0]);
					})
					.attr("y",function(d) {
							return yScale(d[1]);
					})
					.attr("font-family", "sans-serif")
					.attr("font-size", "11px")
					.attr("fill", "red"); */
					
									
					/*svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate("+ (-size) +"," + (h - padding +size) + ")")
						.call(xAxis);
					
					svg.append("g")
						.attr("class", "axis")
						.attr("transform", "translate("+ (padding-size) +","+ (size) +")")
						.call(yAxis);*/
			} else {
				
				var dots = d3.tsv("data.tsv", dottype, function(error, dots) { return dots; });
				dot = container.append("g")
				  	.attr("class", "dot")
				.selectAll("circle")
				  	.data(dots)
					.enter()
				.append("circle")
				  	.attr("r", 0.5)
				  	.attr("cx", function(d) { return d.x; })
					.attr("cy", function(d) { return d.y; });  				

				function dottype(d) {
					d.x = +d.x;
					d.y = +d.y;
					return d;
					}

			}	
				
		}

		</script>
	</body>
</html>